{% load static %}

<div class="overflow-x-auto w-full">
    <table class="table table-xs md:table-md bg-base-100">
        <thead>
        <tr>
            <th class="w-16"></th>
            <th>Pièce</th>
            <th>Dates</th>
            <th>Lieu</th>
            <th class="text-right">Liens</th>
        </tr>
        </thead>
        <tbody>
        {% for play in plays %}
            <tr>
                <!-- Affiche -->
                <td>
                    <div class="avatar">
                        <div class="mask mask-squircle w-12 h-12 hover:scale-125 transition">
                            {% if play.poster %}
                                <img src="{{ play.poster.url }}" alt="Affiche {{ play.title }}">
                            {% else %}
                                <img src="{% static 'promote/poster_your-ad.jpg' %}" alt="Affiche par défaut">
                            {% endif %}
                        </div>
                    </div>
                </td>

                <!-- Titre -->
                <td>
                    <div class="font-semibold">{{ play.title }}</div>
                    <div class="opacity-60">{{ play.get_genre_display }}</div>
                </td>

                <!-- Dates -->
                <td>
                    <div>
                        {{ play.next_datetime|date:"d/m/Y" }}
                        {% if play.representation_count > 1 %}
                            →
                            {{ play.last_datetime|date:"d/m/Y" }}
                        {% endif %}
                    </div>
                    <div class="opacity-60">
                        {% if play.representation_count == 0 %}
                        	Pas de représentation
                        {% else %}
                            {{ play.representation_count }} représentation{{ play.representation_count|pluralize }}
                        {% endif %}
                    </div>
                </td>

                <!-- Lieu -->
                <td>
                    {% with rep=play.upcoming_representations.0 %}
                        <div>{{ rep.city }}</div>
                        <div class="opacity-60">{{ rep.venue }}</div>
                    {% endwith %}
                </td>

                <!-- Liens -->
                <td class="text-right">
                    <div class="flex flex-col gap-1 md:flex-row justify-end">
                        <a href="{% url 'shows:play_detail' play.pk %}" class="btn btn-sm btn-outline">Détails</a>
                        {% if play.ticket_url %}
                            <a href="{{ play.ticket_url }}" target="_blank" class="btn btn-sm btn-primary ml-2">
                                <i class="fa-solid fa-ticket"></i>
                            </a>
                        {% endif %}
                    </div>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="5" class="text-center text-gray-500 py-4">
                    Aucune pièce avec des représentations à venir.
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
